<!DOCTYPE html>
<html lang="en">
    <%- include('../head.ejs') %>
    <body>
        <%- include('../nav.ejs') %>
        <div class="card mx-3 mt-3">
            <h5 class="card-header">
                <%= post.title %>
                <!-- 버튼 위치 오른쪽으로 붙게 해야댐 -->
                <!-- 로그인 기능 만들면 해당 사용자만 삭제/수정가능하도록 추가해야함 if문으로 -->
                <% if (user) { %> <% if (user._id.equals(post.author)) { %>
                <span>
                    <a
                        href="/post/edit/<%= post._id %>"
                        type="button"
                        class="btn btn-sm btn-outline-primary"
                    >
                        수정</a
                    >
                    <button
                        class="btn btn-sm btn-outline-danger delete"
                        data-id="<%= post._id %>"
                    >
                        삭제
                    </button>
                </span>
                <% } %> <% } %>
            </h5>
            <% if (post.img != '') { %>
            <img src="<%= post.img %>" class="card-img-top" alt="..." />
            <% } %>
            <div class="card-body">
                <p class="card-text" style="white-space: pre-line">
                    <%= post.content %>
                </p>
            </div>
            <div class="card-footer">
                <small class="text-body-secondary"><%= post.createdAt %></small>
            </div>
        </div>

        <script>
            document
                .querySelectorAll('.delete')[0]
                .addEventListener('click', async function (e) {
                    try {
                        const postId = e.target.dataset.id;
                        const response = await fetch(`/post/${postId}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        });

                        if (response.ok) {
                            window.location.href = '/post/list/1';
                        } else {
                            console.error('삭제 실패');
                        }
                    } catch (err) {
                        console.error('네트워크 오류', err);
                    }
                });
        </script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
